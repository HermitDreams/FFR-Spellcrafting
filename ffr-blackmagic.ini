[aliases]
n0=/bmag { ; Final Fantasy Randomizer Black Magic Generator. IRC script by Linkshot
n1=  ; Black Spell Initiation
n2=  :blackmagic
n3=  write -c BlackSpell.txt
n4=  var %ffrbmstrskip 0
n5=  var %ffrbmaccskip 0
n6=  var %ffrbmeffect $rand(1,2)
n7=  var %ffrbmohko $rand(1,9)
n8=  var %ffrbmalter $rand(1,2)
n9=  var %ffrbmdebuff $rand(1,12)
n10=  var %ffrbmbuff $rand(1,5)
n11=  var %ffrbmelement $rand(0,8)
n12=  var %ffrbmtarget $rand(1,2)
n13=  var %ffrbmaccroll $rand(0,255)
n14=  var %ffrbmaccuracy $rand($calc((2^$rand(5,6))-1),$calc((2^$rand(1,8))-1))
n15=  var %ffrbmaccsay Undefined
n16=  if (%ffrspellbinding = 1) {
n17=    if (%ffrsplevel = 8) { var %ffrbmstrength 100 }
n18=    else { var %ffrbmstrength $calc( %ffrsplevel * 10) }
n19=  }
n20=  else { var %ffrbmstrength $rand(10,100) }
n21=  var %ffrbmafflict $rand(1,9)
n22=  var %ffrbmpoison $rand(1,5)  
n23=  :bmbase
n24=
n25=  ; -b2: Preserves all slots with damage spells
n26=  if (b2 isincs %ffrspflags) && (%ffrspreroll < 5) {
n27=    if ((%ffrspslot = 1) && (%ffrsplevel != 4)) || ((%ffrsplevel = 1) && (%ffrspslot = 4)) || ((%ffrsplevel = 3) && (%ffrspslot = 3)) || ((%ffrsplevel = 4) && (%ffrspslot = 4)) {
n28=      var %ffrbmeffect 1
n29=      var %ffrbmohko $rand(4,8)
n30=      var %ffrbmb2 1
n31=    }
n32=  }
n33=
n34=  ; Sets Accuracy to Auto-Hit
n35=  if (%ffrbmaccroll < 2) || (%ffrbmaccroll = 148) || (%ffrbmaccsay = Auto-Hit) {
n36=    if (%ffrbmeffect = 1) && (%ffrbmohko < 4) { echo 11 -s Debug: Rejected Auto-Hit on Insta-Kill }
n37=    else { var %ffrbmaccsay Auto-Hit }
n38=  }
n39=  elseif (%ffrspellbinding = 1) {
n40=    if (%ffrsplevel < 5) { var %ffrbmaccuracy 5 | set %ffrbmtier 2 }
n41=    if (%ffrsplevel > 4) { var %ffrbmaccuracy 7 | set %ffrbmtier 3 }
n42=    if (%ffrsplevel = 1) { var %ffrbmaccuracy 4 | set %ffrbmtier 1 }
n43=    if (%ffrsplevel = 8) { var %ffrbmaccuracy 9 | set %ffrbmtier 4 }
n44=  }
n45=  else { var %ffrbmaccsay %ffrbmaccuracy }
n46=
n47=  ; Ensure Confused ailment never casts a buff on self
n48=
n49=  if (C isincs %ffrspflags) && (%ffrspreroll < 5) && (%ffrsplevel = 1) && (%ffrspslot = 1) && (%ffrbmeffect = 2) && (%ffrbmalter = 2) {
n50=    if (%ffrbmbuff = 1) { var %ffrbmdebug ARM }
n51=    elseif (%ffrbmbuff = 2) { var %ffrbmdebug resistance }
n52=    elseif (%ffrbmbuff = 3) { var %ffrbmdebug FAST }
n53=    elseif (%ffrbmbuff = 4) { var %ffrbmdebug TMPR }
n54=    elseif (%ffrbmbuff = 5) { var %ffrbmdebug HIDE }
n55=    else { var %ffrbmdebug Undefined Buff }
n56=    echo 11 -s Debug: Bounced %ffrbmdebug from FIRE slot
n57=    goto blackmagic
n58=  }
n59=
n60=  ; Compatibility with the LOK2 fix
n61=
n62=  if (S isincs %ffrspflags) && (%ffrspreroll < 5) && (%ffrsplevel = 3) && (%ffrspslot = 4) { var %ffrbmeffect 2 | var %ffrbmalter 1 | var %ffrbmdebuff 10 }
n63=
n64=  ; Spell-building
n65=
n66=  ; Black Magic is half Offensive Spells
n67=  ; The other half is Stat Alterations
n68=
n69=  ; 3 in 8 Offensive Spells are Insta-Kills
n70=  ; They have a lowered chance to multi-target
n71=  ; However, Damage Spells have a boosted chance
n72=  if (%ffrbmeffect = 1) {
n73=    if (%ffrbmohko < 4) {
n74=      if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 2 }
n75=      var %ffrbmstrskip 1
n76=      dec %ffrbmtarget $rand(0,1)
n77=      write -al2 BlackSpell.txt Type: Insta-Kill
n78=    }
n79=    else {
n80=      inc %ffrbmtarget $rand(0,1)
n81=      write -al2 BlackSpell.txt Type: Damage
n82=      if (%ffrspellbinding = 1) {
n83=        if (%ffrsplevel = 2) { dec %ffrbmaccuracy 1 }
n84=        if (%ffrbmtarget = 1) && (%ffrsplevel = 8) { inc %ffrbmstrength 20 }
n85=      }
n86=      else {
n87=        if (%ffrbmtarget = 1) { var %ffrbmstrength $floor($calc( %ffrbmstrength * ($calc( $rand(100,150) /100)))) }
n88=      }
n89=      if (%ffrbmstrength isnum 30-49) { set %ffrbmtier 2 }
n90=      elseif (%ffrbmstrength isnum 50-99) { set %ffrbmtier 3 }
n91=      elseif (%ffrbmstrength >= 100) { set %ffrbmtier 4 }
n92=      else { set %ffrbmtier 1 }
n93=    }
n94=  }
n95=  ; Decides whether the Alteration is a buff or debuff
n96=  ; Buffs are rarer than Debuffs
n97=  elseif (%ffrbmeffect = 2) { 
n98=    if (%ffrbmalter = 1) { write -al2 BlackSpell.txt Type: Debuff }
n99=    elseif (%ffrbmalter = 2) {
n100=      if ($rand(0,1) = 0) {
n101=        dec %ffrbmalter 1
n102=        echo 11 -s Debug: Shifting Buff to Debuff
n103=        goto bmbase
n104=      }
n105=      else { echo 7 -s Debug: Buff passed saving roll ( $+ $v1 vs 0) }
n106=      write -al2 BlackSpell.txt Type: Buff
n107=    }
n108=    else { echo 4 -s Value out of range | /halt }
n109=  }
n110=  else { echo 4 -s Value out of range | /halt }
n111=
n112=  ; Stat Alterations
n113=
n114=  if (%ffrbmeffect = 2) {
n115=    if (%ffrbmalter = 1) {
n116=      ; Debug /echo 7 -s Debug: Passing through Debuff (Debuff: %ffrbmdebuff $+ , Element: %ffrbmelement $+ , Poison: %ffrbmpoison $+ )
n117=      if (%ffrspellbinding = 1) && (%ffrbmaccsay = Auto-Hit) && (%ffrbmdebuff < 8) { var %ffrbmdebuff 12 }
n118=      if (%ffrbmdebuff !isnum 9-10) { var %ffrbmstrskip 1 }
n119=      if (%ffrbmdebuff = 1) {
n120=        if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n121=        if (%ffrbmpoison = 1) { write -al3 BlackSpell.txt Effect: Dark & Poison }
n122=        elseif (%ffrbmpoison = 2) { write -al3 BlackSpell.txt Effect: Stun & Poison }
n123=        elseif (%ffrbmpoison = 3) { 
n124=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 1 }
n125=          if (%ffrsplevel > 1) { inc %ffrbmaccuracy 2 }
n126=          write -al3 BlackSpell.txt Effect: Sleep & Poison
n127=        }
n128=        elseif (%ffrbmpoison = 4) {
n129=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n130=          write -al3 BlackSpell.txt Effect: Mute & Poison
n131=        }
n132=        elseif (%ffrbmpoison = 5) {
n133=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 4 }
n134=          write -al3 BlackSpell.txt Effect: Confuse & Poison
n135=        }
n136=        ; Poison Debuff is always stacked on top
n137=        ; So that the spell is useful to players
n138=        if (%ffrbmelement = 3) { write -al4 BlackSpell.txt Element: Time }
n139=        elseif (%ffrbmelement = 4) { write -al4 BlackSpell.txt Element: Death }
n140=        elseif (%ffrbmelement = 5) { write -al4 BlackSpell.txt Element: Fire }
n141=        elseif (%ffrbmelement = 0) { write -al4 BlackSpell.txt Element: None }
n142=        else { write -al4 BlackSpell.txt Element: Poison }
n143=        ; Poisons come in Time, Death, and Fire flavours
n144=        ; But mostly Poison
n145=      }
n146=      elseif (%ffrbmdebuff = 2) { 
n147=        write -al3 BlackSpell.txt Effect: Dark
n148=        if (%ffrbmelement = 2) {
n149=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n150=          write -al4 BlackSpell.txt Element: Poison
n151=        }
n152=        elseif (%ffrbmelement = 3) {
n153=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n154=          write -al4 BlackSpell.txt Element: Time
n155=        }
n156=        elseif (%ffrbmelement = 5) { write -al4 BlackSpell.txt Element: Fire }
n157=        elseif (%ffrbmelement = 8) {
n158=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n159=          write -al4 BlackSpell.txt Element: Earth
n160=        }
n161=        elseif (%ffrbmelement = 0) { write -al4 BlackSpell.txt Element: None }
n162=        else { write -al4 BlackSpell.txt Element: Status }
n163=        ; Darkness comes in Poison, Time, and Earth flavours
n164=        ; But mostly Status
n165=      }
n166=      elseif (%ffrbmdebuff = 3) {
n167=        write -al3 BlackSpell.txt Effect: Stun
n168=        if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 3 }
n169=        if (%ffrbmelement = 3) {
n170=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 4 }
n171=          write -al4 BlackSpell.txt Element: Time
n172=        }
n173=        elseif (%ffrbmelement = 6) { write -al4 BlackSpell.txt Element: Ice }
n174=        elseif (%ffrbmelement = 7) { write -al4 BlackSpell.txt Element: Lit }
n175=        elseif (%ffrbmelement = 0) {
n176=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 5 }
n177=          write -al4 BlackSpell.txt Element: None
n178=        }
n179=        else { write -al4 BlackSpell.txt Element: Status }
n180=        ; Stuns come in Time, Ice, and Lit flavours
n181=        ; But mostly Status
n182=        ; (Change made in May 2019) Black gets an accuracy bonus (redesigned in Dec 2021)
n183=      }
n184=      elseif (%ffrbmdebuff = 4) {
n185=        if (%ffrspellbinding = 1) {
n186=          inc %ffrbmaccuracy 1
n187=          if (%ffrsplevel > 1) { inc %ffrbmaccuracy 2 }
n188=        }
n189=        write -al3 BlackSpell.txt Effect: Sleep
n190=        if (%ffrbmelement = 1) { write -al4 BlackSpell.txt Element: Status }
n191=        elseif (%ffrbmelement = 3) {
n192=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n193=          write -al4 BlackSpell.txt Element: Time
n194=        }
n195=        elseif (%ffrbmelement = 5) { write -al4 BlackSpell.txt Element: Fire }
n196=        elseif (%ffrbmelement = 6) { write -al4 BlackSpell.txt Element: Ice }
n197=        else { write -al4 BlackSpell.txt Element: None }
n198=        ; Sleep comes in Status, Time, Fire, and Ice flavours
n199=        ; But mostly Non-Elemental
n200=      }
n201=      elseif (%ffrbmdebuff = 5) {
n202=        write -al3 BlackSpell.txt Effect: Mute
n203=        if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n204=        if (%ffrbmelement = 2) {
n205=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n206=          write -al4 BlackSpell.txt Element: Poison
n207=        }
n208=        elseif (%ffrbmelement = 3) {
n209=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n210=          write -al4 BlackSpell.txt Element: Time
n211=        }
n212=        elseif (%ffrbmelement = 6) { write -al4 BlackSpell.txt Element: Ice }
n213=        elseif (%ffrbmelement = 0) { write -al4 BlackSpell.txt Element: None }
n214=        else { write -al4 BlackSpell.txt Element: Status }
n215=        ; Mutes come in Poison, Time, and Ice flavours
n216=        ; But mostly Status
n217=      }
n218=      elseif (%ffrbmdebuff = 6) {
n219=        if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 4 }
n220=        write -al3 BlackSpell.txt Effect: Confuse
n221=        if (%ffrbmelement = 3) {
n222=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n223=          write -al4 BlackSpell.txt Element: Time
n224=        }
n225=        elseif (%ffrbmelement = 5) { write -al4 BlackSpell.txt Element: Fire }
n226=        elseif (%ffrbmelement = 7) { write -al4 BlackSpell.txt Element: Lit }
n227=        elseif (%ffrbmelement = 0) { write -al4 BlackSpell.txt Element: None }
n228=        else { write -al4 BlackSpell.txt Element: Status }
n229=        ; Confuse comes in Time, Fire, and Lit flavours
n230=        ; But mostly Status
n231=        ; (Change made in May 2019) Black gets an accuracy bonus
n232=      }
n233=      elseif (%ffrbmdebuff = 7) {
n234=        if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n235=        write -al3 BlackSpell.txt Effect: Dehab
n236=        if (%ffrbmelement = 3) {
n237=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n238=          write -al4 BlackSpell.txt Element: Time
n239=        }
n240=        elseif (%ffrbmelement = 4) {
n241=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n242=          write -al4 BlackSpell.txt Element: Death
n243=        }
n244=        elseif (%ffrbmelement = 5) { write -al4 BlackSpell.txt Element: Fire }
n245=        elseif (%ffrbmelement = 6) { write -al4 BlackSpell.txt Element: Ice }
n246=        elseif (%ffrbmelement = 7) { write -al4 BlackSpell.txt Element: Lit }
n247=        elseif (%ffrbmelement = 8) {
n248=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n249=          write -al4 BlackSpell.txt Element: Earth
n250=        }
n251=        elseif (%ffrbmelement = 0) { write -al4 BlackSpell.txt Element: None }
n252=        else { write -al4 BlackSpell.txt Element: Status }
n253=        ; "Dehab" inflicts everything except Death, Stone, Poison, and Confuse
n254=        ; As such, it doesn't come in Poison flavour
n255=      }
n256=      elseif (%ffrbmdebuff = 8) {
n257=        if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 4 }
n258=        write -al3 BlackSpell.txt Effect: Slow
n259=        if (%ffrbmelement = 1) { write -al4 BlackSpell.txt Element: Status }
n260=        elseif (%ffrbmelement = 2) {
n261=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n262=          write -al4 BlackSpell.txt Element: Poison
n263=        }
n264=        elseif (%ffrbmelement = 6) { write -al4 BlackSpell.txt Element: Ice }
n265=        elseif (%ffrbmelement = 4) {
n266=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n267=          write -al4 BlackSpell.txt Element: Death
n268=        }
n269=        elseif (%ffrbmelement = 0) {
n270=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 3 }
n271=          write -al4 BlackSpell.txt Element: None
n272=        }
n273=        else {
n274=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n275=          write -al4 BlackSpell.txt Element: Time
n276=        }
n277=        ; Slows come in Status, Poison, Ice, and Death flavours
n278=        ; But are usually Time
n279=      }
n280=      elseif (%ffrbmdebuff = 9) {
n281=        if (%ffrspellbinding = 1) {
n282=          dec %ffrbmaccuracy 2
n283=          if (%ffrsplevel > 6) { var %ffrbmstrength $rand(40,64) | set %ffrbmtier 4 }
n284=          else {
n285=            var %ffrbmstrength $floor($calc((%ffrsplevel +1)*5))
n286=            if (%ffrbmstrength < 40) { set %ffrbmtier 3 }
n287=            if (%ffrbmstrength < 30) { set %ffrbmtier 2 }
n288=            if (%ffrbmstrength < 20) { set %ffrbmtier 1 }
n289=          }
n290=        }
n291=        write -al3 BlackSpell.txt Effect: Fear
n292=        if (%ffrbmelement = 4) {
n293=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n294=          var %ffrbmstrength $floor($calc(%ffrbmstrength *1.2))
n295=          write -al4 BlackSpell.txt Element: Death
n296=        }
n297=        elseif (%ffrbmelement = 5) { write -al4 BlackSpell.txt Element: Fire }
n298=        elseif (%ffrbmelement = 8) {
n299=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n300=          write -al4 BlackSpell.txt Element: Earth
n301=        }
n302=        elseif (%ffrbmelement = 1) { write -al4 BlackSpell.txt Element: Status }
n303=        else { write -al4 BlackSpell.txt Element: None }
n304=        ; Fears come in Death, Fire, Earth, and Status flavours
n305=        ; But usually aren't elemental
n306=      }
n307=      elseif (%ffrbmdebuff = 10) {
n308=        if (%ffrspellbinding = 1) {
n309=          inc %ffrbmaccuracy 4
n310=          if (%ffrsplevel = 8) { var %ffrbmstrength $rand(160,240) | set %ffrbmtier 4 }
n311=          else { var %ffrbmstrength $floor($calc(%ffrsplevel *20)) }
n312=          if (%ffrbmstrength < 160) { set %ffrbmtier 3 }
n313=          if (%ffrbmstrength < 100) { set %ffrbmtier 2 }
n314=          if (%ffrbmstrength < 60) { set %ffrbmtier 1 }
n315=        }
n316=        write -al3 BlackSpell.txt Effect: Locked
n317=        if (%ffrbmelement = 3) {
n318=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n319=          write -al4 BlackSpell.txt Element: Time
n320=        }
n321=        elseif (%ffrbmelement = 6) { write -al4 BlackSpell.txt Element: Ice }
n322=        elseif (%ffrbmelement = 7) { write -al4 BlackSpell.txt Element: Lit }
n323=        elseif (%ffrbmelement = 8) {
n324=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n325=          write -al4 BlackSpell.txt Element: Earth
n326=        }
n327=        else { write -al4 BlackSpell.txt Element: None }
n328=        ; Locks come in Time, Ice, Lit, and Earth flavours
n329=        ; But usually aren't elemental
n330=        ; (Change made in May 2019) Black gets an accuracy bonus (redesigned in Dec 2021)
n331=      }
n332=      elseif (%ffrbmdebuff = 11) {
n333=        if (%ffrspellbinding = 1) {
n334=          inc %ffrbmaccuracy 1
n335=          if (%ffrsplevel = 8) { dec %ffrbmaccuracy 1 }
n336=        }
n337=        write -al3 BlackSpell.txt Effect: Dispel
n338=        if (%ffrbmelement = 3) {
n339=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n340=          write -al4 BlackSpell.txt Element: Time
n341=        }
n342=        elseif (%ffrbmelement = 4) {
n343=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n344=          write -al4 BlackSpell.txt Element: Death
n345=        }
n346=        elseif (%ffrbmelement = 7) { write -al4 BlackSpell.txt Element: Lit }
n347=        elseif (%ffrbmelement = 1) { write -al4 BlackSpell.txt Element: Status }
n348=        else {
n349=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 2 }
n350=          write -al4 BlackSpell.txt Element: None
n351=        }
n352=        ; Dispel is the Black name for Xfer
n353=        ; (White calls it Stripped)
n354=        ; Curiously, it can be Time, Death, Lit, or Status
n355=        ; It usually doesn't have an element, thankfully
n356=      }
n357=      ; Power Words get different elemental selection
n358=      elseif (%ffrbmdebuff = 12) {
n359=        if (%ffrspellbinding = 1) && (%ffrsplevel < 6) { echo 11 -s Debug: Bounced a Power Word before Level 6 | goto blackmagic }
n360=        var %ffrbmaccskip 1
n361=        if (%ffrbmafflict = 9) {
n362=          write -a13 BlackSpell.txt Effect: Power Word "Debilitate"
n363=          if (%ffrbmelement = 0) && ($rand(1,5) = 5) { write -al4 BlackSpell.txt Element: None }
n364=          elseif (%ffrbmelement = 3) && ($rand(1,4) = 4) { write -al4 BlackSpell.txt Element: Time }
n365=          elseif (%ffrbmelement = 4) { write -al4 BlackSpell.txt Element: Death }
n366=          else { write -al4 BlackSpell.txt Element: Status }
n367=          ; Dehab heavily favours Status now
n368=          ; But it can still be Time or Death
n369=        }
n370=        elseif (%ffrbmafflict = 1) {
n371=          write -al3 BlackSpell.txt Effect: Power Word "Kill"
n372=          if (%ffrbmelement = 2) { write -al4 BlackSpell.txt Element: Poison }
n373=          elseif (%ffrbmelement = 3) && ($rand(1,5) = 5) { write -al4 BlackSpell.txt Element: Time }
n374=          elseif (%ffrbmelement = 8) { write -al4 BlackSpell.txt Element: Earth }
n375=          elseif (%ffrbmelement = 0) && ($rand(1,10) = 10) { write -al4 BlackSpell.txt Element: None }
n376=          else { write -al4 BlackSpell.txt Element: Death }
n377=          ; Usually, "Kill" is RUB
n378=          ; Sometimes it pulls QAKE, BANE, or ZAP! now
n379=        }
n380=        elseif (%ffrbmafflict = 2) {
n381=          write -al3 BlackSpell.txt Effect: Power Word "Break"
n382=          if (%ffrbmelement = 6) { write -al4 BlackSpell.txt Element: Ice }
n383=          elseif (%ffrbmelement = 0) && ($rand(1,10) = 10) { write -al4 BlackSpell.txt Element: None }
n384=          else { write -al4 BlackSpell.txt Element: Stone }
n385=          ; Oh, and Power Words can cast BRAK too
n386=          ; As well as an Ice variant
n387=        }
n388=        elseif (%ffrbmafflict = 3) || (%ffrbmafflict = 8) {
n389=          write -al3 BlackSpell.txt Effect: Power Word "Decay"
n390=          if (%ffrbmelement = 3) && ($rand(1,2) = 2) { write -al4 BlackSpell.txt Element: Time }
n391=          elseif (%ffrbmelement = 4) { write -al4 BlackSpell.txt Element: Death }
n392=          elseif (%ffrbmelement = 5) { write -al4 BlackSpell.txt Element: Fire }
n393=          elseif (%ffrbmelement = 0) && ($rand(1,4) = 4) { write -al4 BlackSpell.txt Element: None }
n394=          else { write -al4 BlackSpell.txt Element: Poison }
n395=          ; Poison and Confuse are two sides of the same coin
n396=          ; One ticks down players, the other does enemies
n397=          ; So Power Word "Decay" bundles them into one
n398=          ; It can be Time, Death, or even Fire!
n399=          ; Usually just Poison though
n400=        }
n401=        elseif (%ffrbmafflict = 4) {
n402=          write -al3 BlackSpell.txt Effect: Power Word "Blind"
n403=          if (%ffrbmelement = 5) { write -al4 BlackSpell.txt Element: Fire }
n404=          elseif (%ffrbmelement = 7) { write -al4 BlackSpell.txt Element: Lit }
n405=          elseif (%ffrbmelement = 0) { write -al4 BlackSpell.txt Element: None }
n406=          else { write -al4 BlackSpell.txt Element: Status }
n407=          ; BLND has a fairly poor rep, being Darkness
n408=          ; so the Power Word gets to be Fire or Lit
n409=          ; usually just ends up being Status though
n410=        }
n411=        elseif (%ffrbmafflict = 5) {
n412=          write -al3 BlackSpell.txt Effect: Power Word "Stun"
n413=          if (%ffrbmelement = 3) && ($rand(1,2) = 2) { write -al4 BlackSpell.txt Element: Time }
n414=          elseif (%ffrbmelement = 6) { write -al4 BlackSpell.txt Element: Ice }
n415=          elseif (%ffrbmelement = 7) { write -al4 BlackSpell.txt Element: Lit }
n416=          elseif (%ffrbmelement = 0) && ($rand(1,4) = 4) { write -al4 BlackSpell.txt Element: None }
n417=          else { write -al4 BlackSpell.txt Element: Status }
n418=          ; STUN also gets privilege like BLND
n419=          ; It can be Ice or Lit now
n420=          ; Still, usually just Status
n421=        }
n422=        elseif (%ffrbmafflict = 6) || (%ffrbmafflict = 7) {
n423=          write -al3 BlackSpell.txt Effect: Power Word "Coma"
n424=          if (%ffrbmelement = 5) { write -al4 BlackSpell.txt Element: Fire }
n425=          elseif (%ffrbmelement = 6) { write -al4 BlackSpell.txt Element: Ice }
n426=          elseif (%ffrbmelement = 0) { write -al4 BlackSpell.txt Element: None }
n427=          else { write -al4 BlackSpell.txt Element: Status }
n428=          ; Nobody cares about Sleep
n429=          ; Even as a Power Word it's not powerful
n430=          ; So it was bundled in with Mute
n431=          ; It can be Fire or Ice elements
n432=          ; Usually just Status
n433=        }
n434=      }
n435=    }
n436=
n437=    ; Buffs
n438=    ; Black Magic isn't known for being helpful
n439=    ; All Buffs have initial power cut in half
n440=
n441=    ; Process jumps back to here if FAST needs to reroll
n442=    ; so that it doesn't throw away a lot of buffs
n443=    :fastreroll
n444=    if (%ffrbmalter = 2) { 
n445=      var %ffrbmstrength $floor($calc(%ffrbmstrength /2))
n446=      var %ffrbmaccskip 1
n447=      if (%ffrbmbuff = 1) {
n448=        var %ffrbmtarget 2
n449=        write -al3 BlackSpell.txt Effect: Absorb Up
n450=        if (%ffrspellbinding = 1) {
n451=          if (%ffrsplevel = 8) { var %ffrbmstrength 24 | set %ffrbmtier 4 }
n452=          if (%ffrsplevel < 8) { var %ffrbmstrength 16 | set %ffrbmtier 3 }
n453=          if (%ffrsplevel < 5) { var %ffrbmstrength 12 | set %ffrbmtier 2 }
n454=          if (%ffrsplevel < 3) { var %ffrbmstrength 8 | set %ffrbmtier 1 }
n455=        }
n456=        else { var %ffrbmstrength $ceil($calc(%ffrbmstrength * $rand(8,11)/10)) }
n457=      }
n458=      elseif (%ffrbmbuff = 2) {
n459=        if (%ffrspresist > 4) {
n460=          echo 4 -s Resists already capped! Rerolling.
n461=          goto blackmagic
n462=        }
n463=        var %ffrbmstrskip 1
n464=        if ((%ffrspellbinding = 1) && (%ffrsplevel isnum 2-4)) || ((%ffrspellbinding != 1) && (%ffrbmstrength isnum 10-24)) { var %ffrbmtarget 2 }
n465=        else { var %ffrbmtarget 1 }
n466=        if ((%ffrspellbinding = 1) && (%ffrsplevel = 8)) || ((%ffrspellbinding != 1) && ($rand(1,8) = 8)) {
n467=          if (%ffrspwall != 3) {
n468=            set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend all
n469=            set %ffrspwall 3
n470=            inc %ffrspresist 1
n471=          }
n472=          write -al3 BlackSpell.txt Effect: Resist All
n473=          goto barrskip
n474=        }
n475=        if (%ffrbmelement = 1) {
n476=          var %ffrbmresist Status
n477=          if ((%ffrspellbinding = 1) && (%ffrsplevel isnum 5-7)) || ((%ffrspellbinding != 1) && (%ffrbmstrength > 24)) { var %ffrspresmagic 1 }
n478=          else {
n479=            if (%ffrspantiweak != 4) {
n480=              if (%ffrspresist = 0) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend hindrance }
n481=              elseif (%ffrspresist isnum 1-3) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend weak }
n482=              else { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend psi }
n483=              set %ffrspantiweak 4
n484=              inc %ffrspresist 1
n485=            }
n486=          }
n487=        }
n488=        elseif (%ffrbmelement = 2) {
n489=          var %ffrbmresist Poison/Stone
n490=          if ((%ffrspellbinding = 1) && (%ffrsplevel isnum 5-7)) || ((%ffrspellbinding != 1) && (%ffrbmstrength > 24)) { var %ffrspresdecay 1 }
n491=          else {
n492=            if (%ffrspantibane != 5) {
n493=              if (%ffrspresist = 0) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend poisonous }
n494=              elseif (%ffrspresist isnum 1-3) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend bane }
n495=              else { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend gas }
n496=              set %ffrspantibane 5
n497=              inc %ffrspresist 1
n498=            }
n499=          }
n500=        }
n501=        elseif (%ffrbmelement = 3) {
n502=          var %ffrbmresist Time
n503=          if ((%ffrspellbinding = 1) && (%ffrsplevel isnum 5-7)) || ((%ffrspellbinding != 1) && (%ffrbmstrength > 24)) { var %ffrspresdecay 1 }
n504=          else {
n505=            if (%ffrspantizap != 5) {
n506=              if (%ffrspresist = 0) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend dimension }
n507=              elseif (%ffrspresist isnum 1-3) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend time }
n508=              else { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend age }
n509=              set %ffrspantizap 5
n510=              inc %ffrspresist 1
n511=            }
n512=          }
n513=        }
n514=        elseif (%ffrbmelement = 4) {
n515=          var %ffrbmresist Death
n516=          if ((%ffrspellbinding = 1) && (%ffrsplevel isnum 5-7)) || ((%ffrspellbinding != 1) && (%ffrbmstrength > 24)) {
n517=            if ($rand(1,2) = 1) { var %ffrspresmagic 1 }
n518=            else { var %ffrspresdecay 1 }
n519=          }
n520=          else {
n521=            if (%ffrspantinecro != 4) {
n522=              if (%ffrspresist = 0) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend necrotic }
n523=              elseif (%ffrspresist isnum 1-3) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend evil }
n524=              else { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend rub }
n525=              set %ffrspantinecro 4
n526=              inc %ffrspresist 1
n527=            }
n528=          }
n529=        }
n530=        elseif (%ffrbmelement = 5) {
n531=          var %ffrbmresist Fire
n532=          if ((%ffrspellbinding = 1) && (%ffrsplevel isnum 5-7)) || ((%ffrspellbinding != 1) && (%ffrbmstrength > 24)) { var %ffrspresdragon 1 }
n533=          else {
n534=            if (%ffrspantifire != 4) {
n535=              if (%ffrspresist = 0) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend burning }
n536=              elseif (%ffrspresist isnum 1-3) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend fire }
n537=              else { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend hot }
n538=              set %ffrspantifire 4
n539=              inc %ffrspresist 1
n540=            }
n541=          }
n542=        }
n543=        elseif (%ffrbmelement = 6) {
n544=          var %ffrbmresist Ice
n545=          if ((%ffrspellbinding = 1) && (%ffrsplevel isnum 5-7)) || ((%ffrspellbinding != 1) && (%ffrbmstrength > 24)) { var %ffrspresdragon 1 }
n546=          else {
n547=            if (%ffrspantiice != 4) {
n548=              if (%ffrspresist = 0) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend freezing }
n549=              elseif (%ffrspresist isnum 1-3) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend cold }
n550=              else { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend ice }
n551=              set %ffrspantiice 4
n552=              inc %ffrspresist 1
n553=            }
n554=          }
n555=        }
n556=        elseif (%ffrbmelement = 7) {
n557=          var %ffrbmresist Lit
n558=          if ((%ffrspellbinding = 1) && (%ffrsplevel isnum 5-7)) || ((%ffrspellbinding != 1) && (%ffrbmstrength > 24)) { var %ffrspresdragon 1 }
n559=          else {
n560=            if (%ffrspantilightning != 9) {
n561=              if (%ffrspresist = 0) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend lightning }
n562=              elseif (%ffrspresist isnum 1-3) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend volt }
n563=              else { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend ion }
n564=              set %ffrspantilightning 9
n565=              inc %ffrspresist 1
n566=            }
n567=          }
n568=        }
n569=        elseif (%ffrbmelement = 8) {
n570=          var %ffrbmresist Earth
n571=          if ((%ffrspellbinding = 1) && (%ffrsplevel isnum 5-7)) || ((%ffrspellbinding != 1) && (%ffrbmstrength > 24)) { var %ffrspresmagic 1 }
n572=          else {
n573=            if (%ffrspantiquake != 5) {
n574=              if (%ffrspresist = 0) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend tectonic }
n575=              elseif (%ffrspresist isnum 1-3) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend land }
n576=              else { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend geo }
n577=              set %ffrspantiquake 5
n578=              inc %ffrspresist 1
n579=            }
n580=          }
n581=        }
n582=        else {
n583=          var %ffrbmstrskip 0
n584=          write -al3 BlackSpell.txt Effect: Regenerate
n585=          if (%ffrspellbinding = 1) { set %ffrbmregmod %ffrsplevel }
n586=          else { set %ffrbmregmod $calc(%ffrbmstrength /6) }
n587=          var %ffrbmstrength $floor($calc(($rand(18,22) /10)^ ($rand(25,40) /10 + %ffrbmregmod / 2) + (%ffrbmregmod - 1) /2 ))
n588=          if (%ffrspellbinding = 1) {
n589=            if (%ffrsplevel < 7) { set %ffrbmtier 3 }
n590=            if (%ffrsplevel < 5) { set %ffrbmtier 2 }
n591=            if (%ffrsplevel < 3) { set %ffrbmtier 1 }
n592=          }
n593=          else { set %ffrbmtier $ceil($calc(%ffrbmstrength / $rand(32,64)))
n594=            if (%ffrbmtier > 3) { echo 7 -s Regen Power: %ffrbmstrength }
n595=          }
n596=        }
n597=        if (%ffrspresmagic = 1) {
n598=          var %ffrbmresist Magic
n599=          if (%ffrspantimagic != 5) {
n600=            if (%ffrspresist = 0) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend mortality }
n601=            elseif (%ffrspresist isnum 1-2) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend life }
n602=            elseif (%ffrspresist = 3) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend magic }
n603=            else { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend bio }
n604=            set %ffrspantimagic 5
n605=            inc %ffrspresist 1
n606=          }
n607=        }
n608=        elseif (%ffrspresdecay = 1) {
n609=          var %ffrbmresist Decay
n610=          if (%ffrspantitoxin != 5) {
n611=            if (%ffrspresist = 0) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend futility }
n612=            elseif (%ffrspresist isnum 1-2) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend doom }
n613=            elseif (%ffrspresist = 3) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend waste }
n614=            else { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend rot }
n615=            set %ffrspantitoxin 5
n616=            inc %ffrspresist 1
n617=          }
n618=        }
n619=        elseif (%ffrspresdragon = 1) {
n620=          var %ffrbmresist Dragon
n621=          if (%ffrspantidamage != 5) {
n622=            if (%ffrspresist = 0) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend elemental }
n623=            elseif (%ffrspresist isnum 1-2) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend wyrm }
n624=            elseif (%ffrspresist = 3) { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend spell }
n625=            else { set %ffrspresmsg $+ $calc(%ffrspresist +1) Defend wiz }
n626=            set %ffrspantidamage 5
n627=            inc %ffrspresist 1
n628=          }
n629=        }
n630=        if (%ffrbmelement isnum 1-8) { write -al3 BlackSpell.txt Effect: Resist %ffrbmresist }
n631=      }
n632=      elseif (%ffrbmbuff = 3) {
n633=        ; if (%ffrspellbinding != 1) {
n634=        ;   if ($rand(0,1) = 1) { var %ffrbmbuff $rand(1,5) | /echo 11 -s Debug: Rerolling failed FAST (0 vs $v1 $+ ) | goto fastreroll }
n635=        ; }
n636=        ; if ($rand(1,20) > $rand(1,100)) { var %ffrbmtarget 3 | /echo 7 Debug: Passed FURY roll ( $+ $v1 vs $v2 $+ ) }
n637=        if ((%ffrspellbinding != 1) && (%ffrbmstrength < 25)) || ((%ffrspellbinding = 1) && (%ffrsplevel < 4)) { var %ffrbmtarget 1 }
n638=        elseif ((%ffrspellbinding != 1) && (%ffrbmstrength >= 40)) || ((%ffrspellbinding = 1) && (%ffrsplevel > 7)) { var %ffrbmtarget 3 }
n639=        else { var %ffrbmtarget 2 }
n640=        ; Trying out power-based FAST targetting rather than random
n641=        var %ffrbmstrskip 1
n642=        write -al3 BlackSpell.txt Effect: Double Hits
n643=        ; However, Black Magic likes to hurt things
n644=        ; FAST hurts things. A lot.
n645=        ; To prevent most buffs just rolling FAST,
n646=        ; it has to win a coinflip to pass
n647=        ; Also has a 20% chance to boost the whole party
n648=      }
n649=      elseif (%ffrbmbuff = 4) {
n650=        write -al3 BlackSpell.txt Effect: Attack Up 
n651=        if (%ffrbmtarget > 1) {
n652=          if (%ffrspellbinding = 1) {
n653=            var %ffrbmstrength $floor($calc(%ffrsplevel *3+ $rand(3,5)))
n654=            if (%ffrbmstrength < 27) { set %ffrbmtier 3 }
n655=            else { set %ffrbmtier 4 }
n656=            if (%ffrbmstrength < 18) { set %ffrbmtier 2 }
n657=            if (%ffrbmstrength < 12) { set %ffrbmtier 1 }
n658=          }
n659=          else { var %ffrbmstrength $calc($rand(5,19) + $rand(1,10)) }
n660=          if ($rand(1,20) > $rand(1,50)) {
n661=            var %ffrbmtarget 3
n662=            if (%ffrspellbinding = 1) { var %ffrbmstrength $floor($calc(%ffrbmstrength / (($rand(100,120) /10 - %ffrsplevel)/2)+5)) }
n663=            else { var %ffrbmstrength $ceil($calc(%ffrbmstrength * ($rand(75,100)/100))) }
n664=          }
n665=          else { /echo 7 Debug: RALY failed ( $+ $v1 vs $v2 $+ ) }
n666=        }
n667=        ; TMPR hurts things too
n668=        ; It comes in varying strengths so no coinflip
n669=        ; It use its own dice, which end up between
n670=        ; 6 and 29, averaging high teens to low 20s
n671=        else {
n672=          if (%ffrspellbinding = 1) {
n673=            var %ffrbmstrength $floor($calc(2^(1.5+ %ffrsplevel /2) +(9- %ffrsplevel)+ %ffrsplevel /2))
n674=            if (%ffrbmstrength < 50) { set %ffrbmtier 3 }
n675=            else { set %ffrbmtier 4 }
n676=            if (%ffrbmstrength < 22) { set %ffrbmtier 2 }
n677=            if (%ffrbmstrength < 15) { set %ffrbmtier 1 }
n678=          }
n679=          else { var %ffrbmstrength $rand(5,50) }
n680=        }
n681=        ; SABR is allowed to wildly vary from 5 to 50
n682=      }
n683=      elseif (%ffrbmbuff = 5) {
n684=        var %ffrbmtarget 2
n685=        write -al3 BlackSpell.txt Effect: Evade Up
n686=        if (%ffrspellbinding = 1) {
n687=          if (%ffrsplevel = 8) { var %ffrbmstrength 80 | set %ffrbmtier 4 }
n688=          if (%ffrsplevel < 8) { var %ffrbmstrength 60 | set %ffrbmtier 3 }
n689=          if (%ffrsplevel < 5) { var %ffrbmstrength 40 | set %ffrbmtier 2 }
n690=          if (%ffrsplevel < 3) { var %ffrbmstrength 30 | set %ffrbmtier 1 }
n691=        }
n692=        else { var %ffrbmstrength $floor($calc(%ffrbmstrength * $rand(10,18)/10)) }
n693=      }
n694=    }
n695=  }
n696=
n697=  ; Offensive Spells need Elements too
n698=  ; Black Magic is better at damaging
n699=  ; So it never uses Status, Time, or Earth
n700=  ; Those instead give more weight to Fire, Ice, and Lit
n701=  ; It has a bit of a fetish for Poison and Death though
n702=  ; Death hits harder
n703=
n704=  ; Non-elemental Instakills have to pass a 10% check
n705=  ; Fire, Ice, and Lit Instakills have to pass 25%
n706=  ; Smoke=Poison, Break=Stone, Exile=Time, Erase=Death
n707=  ; So Ice inflicts Stone and requires Softening
n708=  if (%ffrbmeffect = 1) {
n709=    if (%ffrbmohko < 4) { 
n710=      :blackohko
n711=      if (%ffrbmelement = 0) {
n712=        if ($rand(1,10) = 10) { write -al4 BlackSpell.txt Element: None }
n713=        else {
n714=          /echo 11 -s Debug: FALL failed ( $+ $v1 vs 10). Switching to QAKE.
n715=          var %ffrbmelement 8
n716=          goto blackohko
n717=        }
n718=      }
n719=      elseif (%ffrbmelement = 1) {
n720=        if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n721=        write -al4 BlackSpell.txt Element: Smoke
n722=      }
n723=      elseif (%ffrbmelement = 2) {
n724=        if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 3 }
n725=        write -al4 BlackSpell.txt Element: Break
n726=      }
n727=      elseif (%ffrbmelement = 3) {
n728=        if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n729=        write -al4 BlackSpell.txt Element: Exile
n730=      }
n731=      elseif (%ffrbmelement = 4) {
n732=        if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n733=        write -al4 BlackSpell.txt Element: Erase
n734=      }
n735=      elseif (%ffrbmelement = 5) {
n736=        if ($rand(1,4) = 4) { write -al4 BlackSpell.txt Element: Fire }
n737=        ; Use "Erased"
n738=        else { /echo 11 -s Debug: MELT failed ( $+ $v1 vs 4). Switching to RUB.
n739=          var %ffrbmelement 4
n740=          goto blackohko
n741=        }
n742=      }
n743=      elseif (%ffrbmelement = 6) {
n744=        if ($rand(1,4) = 4) {
n745=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 1 }
n746=          write -al4 BlackSpell.txt Element: Ice
n747=        }
n748=        ; Use "Broken"
n749=        else { /echo 11 -s Debug: CRYO failed ( $+ $v1 vs 4). Switching to a poison.
n750=          var %ffrbmelement $rand(1,2)
n751=          goto blackohko
n752=        }
n753=      }
n754=      elseif (%ffrbmelement = 7) {
n755=        if ($rand(1,4) = 4) { write -al4 BlackSpell.txt Element: Lit }
n756=        ; Use "Exiled"
n757=        else { /echo 11 -s Debug: SMIT failed ( $+ $v1 vs 4). Switching to ZAP!
n758=          var %ffrbmelement 3
n759=          goto blackohko
n760=        }
n761=      }
n762=      elseif (%ffrbmelement = 8) {
n763=        if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n764=        write -al4 BlackSpell.txt Element: Crack
n765=      }
n766=    }
n767=    else {
n768=      if ($rand(1,3) = 3) { echo 11 -s Debug: Forcing element to Fire, Ice, or Lit ( $+ $v1 vs 3) | var %ffrbmelement $rand(5,7) }
n769=      :blackdamage
n770=      if (%ffrbmelement = 1) {
n771=        if ($rand(1,20) > $rand(1,60)) {
n772=          var %ffrbmstrength $floor($calc(%ffrbmstrength *1.25))
n773=          write -al4 BlackSpell.txt Element: Kinetic
n774=        }
n775=        else {
n776=          write -al4 BlackSpell.txt Element: Lit
n777=          echo 11 -s Debug: Kinetic failed ( $+ $v1 vs $v2 $+ )
n778=        }
n779=      }
n780=      elseif (%ffrbmelement = 2) { 
n781=        if ($rand(1,20) > $rand(1,60)) { 
n782=          var %ffrbmstrength $floor($calc(%ffrbmstrength *1.1))
n783=          write -al4 BlackSpell.txt Element: Storm
n784=        }
n785=        else {
n786=          echo 11 -s Debug: Storm failed ( $+ $v1 vs $v2 $+ )
n787=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 2 }
n788=          write -al4 BlackSpell.txt Element: Poison
n789=        }
n790=      }
n791=      elseif (%ffrbmelement = 3) {
n792=        if ($rand(1,20) > $rand(1,60)) {
n793=          var %ffrbmstrength $floor($calc(%ffrbmstrength *1.1))
n794=          write -al4 BlackSpell.txt Element: Plasma
n795=        }
n796=        else {
n797=          write -al4 BlackSpell.txt Element: Ice
n798=          echo 11 -s Debug: Plasma failed ( $+ $v1 vs $v2 $+ )
n799=        }
n800=      }
n801=      elseif (%ffrbmelement = 4) {
n802=        if ($rand(1,20) > $rand(1,60)) { 
n803=          var %ffrbmstrength $floor($calc(%ffrbmstrength *1.25))
n804=          write -al4 BlackSpell.txt Element: Antipode
n805=        }
n806=        else {
n807=          echo 11 -s Debug: Antipode failed ( $+ $v1 vs $v2 $+ )
n808=          if (%ffrspellbinding = 1) { dec %ffrbmaccuracy 1 }
n809=          var %ffrbmstrength $floor($calc( %ffrbmstrength * 1.2 ))
n810=          if (%ffrbmstrength = 144) { dec %ffrbmstrength 24 }
n811=          write -al4 BlackSpell.txt Element: Death
n812=        }
n813=      }
n814=      elseif (%ffrbmelement = 5) { write -al4 BlackSpell.txt Element: Fire }
n815=      elseif (%ffrbmelement = 6) { write -al4 BlackSpell.txt Element: Ice }
n816=      elseif (%ffrbmelement = 7) { write -al4 BlackSpell.txt Element: Lit }
n817=      elseif (%ffrbmelement = 8) {
n818=        if ($rand(1,20) > $rand(1,60)) {
n819=          var %ffrbmstrength $floor($calc(%ffrbmstrength *1.25))
n820=          write -al4 BlackSpell.txt Element: Magma
n821=        }
n822=        else {
n823=          echo 11 -s Debug: Magma failed ( $+ $v1 vs $v2 $+ )
n824=          write -al4 BlackSpell.txt Element: Fire
n825=        }
n826=      }
n827=      else {
n828=        if ($rand(1,20) >= $rand(1,20)) { 
n829=          write -al4 BlackSpell.txt Element: None
n830=          if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 1 }
n831=        }
n832=        else { /echo 11 -s Debug: NUKE failed ( $+ $v1 vs $v2 $+ ). Switching to basic element.
n833=          var %ffrbmelement $rand(5,7)
n834=          goto blackdamage
n835=        }
n836=      }
n837=    }
n838=  }
n839=
n840=  ; -b2: Ensuring targeting remains
n841=
n842=  if (%ffrbmb2 = 1) {
n843=    if (%ffrsplevel isnum 1-2) { var %ffrbmtarget 1 }
n844=    elseif (%ffrsplevel isnum 3-7) { var %ffrbmtarget 2 }
n845=  }
n846=
n847=  ; Writes the target down to a file
n848=  ; First checks if FAST or TMPR is AoE
n849=  ; Then checks if it's a Buff or not
n850=  ; Only TMPR and FAST can target all allies
n851=  :barrskip
n852=  if (%ffrbmeffect = 2) && (%ffrbmtarget = 3) { write -al5 BlackSpell.txt Target: All Allies | goto targetjump }
n853=  if (%ffrbmeffect = 1) || ((%ffrbmeffect = 2) && (%ffrbmalter = 1)) {
n854=    if (%ffrbmtarget < 2) {
n855=      if (%ffrspellbinding = 1) { inc %ffrbmaccuracy 1 }
n856=      write -al5 BlackSpell.txt Target: Single Enemy
n857=    }
n858=    elseif (%ffrbmtarget > 1) { write -al5 BlackSpell.txt Target: Enemy Party }
n859=  }
n860=  elseif (%ffrbmeffect = 2) && (%ffrbmalter = 2) {
n861=    if (%ffrbmtarget = 1) { write -al5 BlackSpell.txt Target: Caster }
n862=    elseif (%ffrbmtarget = 2) { write -al5 BlackSpell.txt Target: Single Ally }
n863=  }
n864=  ; This just makes sure it doesn't overwrite All Allies
n865=  :targetjump
n866=
n867=  ; Accuracy Balance
n868=  ; Defines the appropriate tiers of Accuracy for Spellbooks
n869=  ; Accuracy no longer caps
n870=  ; Instakills can't be Auto-Hit
n871=  if (%ffrspellbinding = 1) && (%ffrbmaccsay = Undefined) {
n872=    if (%ffrbmaccuracy < 2) { var %ffrbmaccsay 0 }
n873=    elseif (%ffrbmaccuracy = 2) { var %ffrbmaccsay 5 }
n874=    elseif (%ffrbmaccuracy = 3) { var %ffrbmaccsay 8 }
n875=    elseif (%ffrbmaccuracy = 4) { var %ffrbmaccsay 16 }
n876=    elseif (%ffrbmaccuracy = 5) { var %ffrbmaccsay 24 }
n877=    elseif (%ffrbmaccuracy = 6) { var %ffrbmaccsay 32 }
n878=    elseif (%ffrbmaccuracy = 7) { var %ffrbmaccsay 40 }
n879=    elseif (%ffrbmaccuracy = 8) { var %ffrbmaccsay 48 }
n880=    elseif (%ffrbmaccuracy = 9) { var %ffrbmaccsay 64 }
n881=    elseif (%ffrbmaccuracy = 10) { var %ffrbmaccsay 107 }
n882=    elseif (%ffrbmaccuracy = 11) { var %ffrbmaccsay 128 }
n883=    elseif (%ffrbmaccuracy = 12) { var %ffrbmaccsay 152 }
n884=    elseif (%ffrbmaccuracy = 13) { var %ffrbmaccsay 175 }
n885=    elseif (%ffrbmaccuracy = 14) { var %ffrbmaccsay 210 }
n886=    else { var %ffrbmaccsay 255 | echo 7 -s Debug: Assumed Accuracy was Auto-Hit }
n887=  }
n888=
n889=  ; Cleanup Section
n890=
n891=  ; Outputs only information relevant to the spell
n892=  if (%ffrbmstrskip = 0) && (%ffrbmaccskip = 0) { write -s15 BlackSpell.txt Power: %ffrbmstrength | write -al6 BlackSpell.txt Acc Bonus: %ffrbmaccsay }
n893=  elseif (%ffrbmstrskip = 0) && (%ffrbmaccskip = 1) { write -s15 BlackSpell.txt Power: %ffrbmstrength }
n894=  elseif (%ffrbmstrskip = 1) && (%ffrbmaccskip = 0) { write -s15 BlackSpell.txt Acc Bonus: %ffrbmaccsay }
n895=
n896=  ; Rerolls if spell is incompatible during Spellbinding
n897=  if (e isincs %ffrspflags) && (%ffrspreroll < 5) {
n898=    if (%ffrbmeffect = 2) && (%ffrbmalter = 1) && ((%ffrbmdebuff = 6) || (%ffrbmdebuff = 9)) {
n899=      if (%ffrbmdebuff = 6) { var %ffrbmdebug CONF }
n900=      elseif (%ffrbmdebuff = 9) { var %ffrbmdebug FEAR }
n901=      if (%ffrsplevel = 1) || (%ffrsplevel = 5) || (%ffrsplevel = 8) { /echo 11 -s Debug: Bounced %ffrbmdebug during spellbinding | goto blackmagic }
n902=      elseif ((%ffrsplevel = 4) || (%ffrsplevel = 6) || (%ffrsplevel = 7)) && (%ffrspslot != 3) { /echo 11 -s Debug: Bounced %ffrbmdebug during spellbinding | goto blackmagic }
n903=      elseif (%ffrsplevel = 2) && ((%ffrspslot = 2) || (%ffrspslot = 4)) { /echo 11 -s Debug: Bounced %ffrbmdebug during spellbinding | goto blackmagic }
n904=      elseif (%ffrsplevel = 3) && (%ffrspslot != 4) { /echo 11 -s Debug: Bounced %ffrbmdebug during spellbinding | goto blackmagic }
n905=    }
n906=  }
n907=
n908=  ; Skips text output for Spellbinding
n909=  ; That would open 64 Notepad windows
n910=  ; Also keeps track of AoE Damage Spells
n911=  if (%ffrnowrite != 1) { /run BlackSpell.txt }
n912=  elseif (%ffrbmeffect = 1) && (%ffrbmtarget > 1) && (%ffrbmohko > 3) { inc %ffrspblackAoE 1 }
n913=
n914=}
